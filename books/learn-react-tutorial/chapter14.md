---
title: "コンポーネントを純粋に保つ"
---

## 🌱 純関数 (pure function)とは

「与えられた入力に対して計算だけを行い、他には何もしない関数」のことです。

React では、**コンポーネントをできるだけ純関数として書く**ことが推奨されています。
そうすることで、コードベースが成長したときに起こりがちな、

- 不可解なバグ
- 予測しづらい挙動
- 再現しにくい不具合

といった問題を防ぐことができます。

```ts
// 純関数のシンプルな例
const double(number) {
  return 2 * number;
}
```

この関数は、
1. 外部の変数を参照しない
2. 外部の状態を変更しない
3. 同じ入力には必ず同じ出力を返す

という特徴を持っており、純関数の条件を満たしています。

## 🌱 純関数が守るべきルール
純関数として振る舞うためには、いくつかのルールがあります。

:::message
**ポイント**
- 自分の仕事に集中する
  → 呼び出される前から存在しているオブジェクトや変数を変更しない
- 同じ入力には同じ出力
  → 同じ入力を与えると、常に同じ結果を返す

これらのルールを守ることで、**「いつ・何回呼ばれても安心して使える関数」** になります。
:::



## 🌱 副作用：意図せぬ (?) 付随処理
純関数のルールを破ってしまう代表例が、**副作用（side effect）** です。

:::message alert
外部で宣言された`guest`変数を読み書きしています。
そのため、このコンポーネントを複数回呼び出すと、異なる JSX が生成されます。
```ts
let guest = 0;

function Cup() {
  // Bad: 既存の変数を変更している
  guest = guest + 1;
  return <h2>Tea cup for guest #{guest}</h2>;
}

export default function TeaSet() {
  return (
    <>
      <Cup />
      <Cup />
      <Cup />
    </>
  );
}

```
:::

この`Cup`コンポーネントは、
- 外部変数 guest に依存している
- 呼び出すたびに外部の状態を変更している
という点で、**純関数** ではありません。

その結果、
- 呼び出し順によって表示が変わる
- 再レンダー時に予期しない表示になる

といった問題が発生しやすくなります。
