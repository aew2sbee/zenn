---
title: "[テスト] サンプル仕様からテストパターンを考える" # 記事のタイトル
emoji: "🧪" # アイキャッチとして使われる絵文字（1文字だけ）
type: "tech" # tech: 技術記事 / idea: アイデア記事
topics: ["テスト", "初心者向け", "ブラックボックステスト技法"] # タグ。["markdown", "rust", "aws"]のように指定する
published: true # 公開設定（falseにすると下書き）
---
## はじめに
約2年間QAエンジニアとして活動しておりました。
社内メンバーにテストに関する初歩の知識を共有したく執筆します。

考えた方がいいテスト観点を並べるだけでは、理解が難しいと考えたため
サンプルの仕様を例にしてテストパターンを考えたいと思います。

## 仕様

`年齢`と`性別`を入力欄に値を入力すると
DBから`料金`の値を返してくれる機能があるとします。
![test-image](/images/test-image.png)

詳細の仕様は下記の通りです

|  利用する人  | 料金  |
| ---- | ---- |
|  `0`~`6`歳未満の子供  |  `0`円  |
|  `6`~`18`歳未満の`女の子`  |  `450`円  |
|  `6`~`18`歳未満の`男の子`  |  `500`円  |
|  `18`歳以上の`女性`  |  `1000`円  |
|  `18`歳以上の`男性`  |  `1200`円  |

例えば、`10`歳の`男の子`なら料金は`500`円になります。

データでイメージするなら`Iutput.json`が人のデータです。
料金のデータを`Output.json`で表現します。
````json:Iutput.json
{
    "age" : 10,
    "gender" : "mele"
}
````
````json:Output.json
{
    "price" : 500
}
````

いきなり、テストのパターンを考えるのは難しいので、スコープを小さくして考えます。
## Q. 【正常系】年齢に関して何パターンを想定したら良いのか？
### 1. まずは、仕様から読み取れるテストパターンを算出する
年齢に関する仕様を表形式にまとめると下記の通りになります。
`0 <= age < 6`, `6 <= age < 18`, `age <= 18`の**3パターン**はテストパターンが必要そうですね。

|  項目  | 内容  |
| ---- | ---- |
|  **子供**  |  `0 <= age < 6`  |
|  **学生**  |  `6 <= age < 18`  |
|  **成人**  |  `age <= 18`  |

しかし、これだけではテストパターンは不十分です。
`境界値分析`と`同値分割法`の観点でテストパターンを追加できるか確認しましょう

#### 「境界値分析」とは？
>境界値分析とはブラックボックステスト技法の一つであり、境界となる値(同値クラスの端) とその前後の値に対してテストする技法です。

#### 「同値分割法」とは？
> 同値分割法は、ブラックボックステスト技法の一つであり、入力値により同じ処理をするグループに分割し、グループ内で代表的な入力値を選択しテストする技法です。

### 2. 境界値分析(境界となる値)を考慮したら？
- `0 <= age < 6`に対して「`0`,`6`」が考えられる
- `6 <= age < 18`に対して「`6`,`18`」が考えられる
- `age <= 18`に対して「`18`」が考えられる

### 3. 境界値分析(境界値の前後の値)を考慮したら？
- `0 <= age < 6`に対して「`-1`,`1`,`5`,`7`」が考えられる
- `6 <= age < 18`に対して「`5`,`7`,`17`,`19`」が考えられる
- `age <= 18`に対して「`17`,`19`」が考えられる

### 4. 境界値分析を考慮結果まとめると。。。
年齢に対する「`-1`,`0`,`1`,`5`,`6`,`7`,`17`,`18`,`19`」の**9パターン**が想定出来ます。

### 5. 同値分割法を考慮したら？
※代表的な入力値は、入力範囲内であれば大丈夫です. 
入力範囲の**中央の値**を考えると考えやすい
- `0 <= age < 6`に対して「`-3`,`3`,`9`」が考えられる
- `6 <= age < 18`に対して「`3`,`9`,`21`」が考えられる
- `age <= 18`に対して「`9`,`21`」が考えられる


### 5. 境界値分析と同値分割法を考慮結果まとめると。。。
年齢に対する「`-3`,`-1`,`0`,`1`,`3`,`5`,`6`,`7`,`9`,`17`,`18`,`19`,`21`」の**13パターン**が想定出来ます。
:::message
Q. 年齢に関して何パターンを想定したら良いのか？
A. 年齢に対して**13パターン**
:::




## Q. 【正常系】性別に関して何パターンを想定したら良いのか？
### 1. まずは、仕様から読み取れるテストパターンを算出する
`男性`, `女性`の**2パターン**はテストパターンが必要そうですね。

しかし、これだけではテストパターンは不十分です。
同様に`境界値分析`と`同値分割法`の観点でテストパターンを追加できるか確認しましょう

### 2. 境界値分析と同値分割法を考慮したら？
`男性`, `女性`以外の選択肢として`その他`が想定出来ます.
性別に対する`男性`,`女性`,`その他`の**3パターン**が想定出来ます。


### 3. 境界値分析と同値分割法を考慮結果まとめると。。。
性別に対する`男性`,`女性`,`その他`の**3パターン**が想定出来ます。
:::message
Q. 性別に関して何パターンを想定したら良いのか？
A. 性別に対して**3パターン**
:::



## Q. 正常系で想定されるテストパターンとは？

つまり、年齢に対するの**13パターン**と性別に対して**3パターン**で**39パターン**が想定出来ます。
:::message
Q. 正常系で想定されるテストパターンとは？
A. **39パターン**(13*3=39)が想定出来ます
:::

|  年齢  | 女性 | 男性 | その他 |
| ---- | ---- | ---- | ---- |
|  -3  |  0円  |  0円  |  Error  |
|  -1  |  0円  |  0円  |  Error  |
|  0　 |  0円  |  0円  |  Error  |
|  1   |  0円 |  0円  |  Error  |
|  3  |  0円  |  0円  |  Error  |
|  5  |  0円  |  0円  |  Error  |
|  6  |  450円  |  500円  |  Error  |
|  7  |  450円  |  500円  |  Error  |
|  9  |  450円  |  500円  |  Error  |
|  17  |  450円  |  500円  |  Error  |
|  18  |  1000円  |  1200円  |  Error  |
|  19  |  1000円  |  1200円  |  Error  |
|  21  |  1000円  |  1200円  |  Error  |


## Q. 【異常系】入力値の型が違うパターンも想定していますか？
### 1. 数値型じゃなくて文字列型の場合
同じ`6`でも型が違う場合でも正しく動作するのか？
````diff json:Iutput.json
{
-    "age" : 6,
+    "age" : "6",
    "gender" : "famele"
}
````
### 2. 数値型じゃなくて浮動小数点数型の場合
ほぼ同じ値を示す`6`でも型が違う場合でも正しく動作するのか？
````diff json:Iutput.json
{
-    "age" : 6,
+    "age" : 6.0,
    "gender" : "famele"
}
````


#### データ型の一覧
|  データ型  | 説明 | 例  |
| ---- | ---- | ---- |
|  **整数(int型)**  |  小数を含まない値を扱うためのデータ型。  |  0、 1、 100、 999、 -123  |
|  **小数（float型、double型）**  |  小数を含む値を扱うためのデータ型。  | 1.23、3.14、 -99.9  |
|  **文字列(String型)**  |  文字列を扱うためのデータ型。ダブルクオテーション(“)でくくります。  | ”ABC”、“TOKYO”、“プログラミング”  |
|  **論理型(boolean型)**  |  「真」「偽」を扱うためのデータ型。  | true, false  |
|  **日付型(datetime型)**  |  「日付」や「時間」を扱うためのデータ型。  | true, false  |
|  **null型**  |  「値が存在しないこと」を扱うためのデータ型。  | null  |

:::message
全ての型のテストパターンを実施すれば、より安全なプログラムを書くことが出来ますが、
全部テストにそれを実施するととても時間が足りません。
なので、仕様に合わせて必要な型のみを実施する事をおすすめします。
:::

## Q. 【異常系】Keyの値が間違っているパターンも想定していますか？
プログラムの処理内で`"age"`というKeyを探す処理があると思いますが、`"age"`というKeyが見つからなくErrorにならないのか？
````diff json:Iutput.json
{
-    "age" : 6,
+    "agee" : 6,
    "gender" : "famele"
}
````

## Q. 【異常系】余分なKeyが追加されているパターンも想定していますか？
プログラムの処理内で`"name"`という余分なKeyがあった場合でも期待通りの`Output.json`が返ってくるか？
````diff json:Iutput.json
{
    "age" : 6,
    "gender" : "famele",
+    "name" : "taro",
}
````

## Q. 【異常系】必要なKeyが不足しているパターンも想定していますか？
`"age"`というKeyが見つからなくErrorにならないのか？
````diff json:Iutput.json
{
-    "age" : 6,
    "gender" : "famele",
}
````

## Q. 【異常系】もしDBに返る値がないパターンも想定していますか？
DBに必ずしもデータがあるとは限りません。
対象のデータがない場合もErrorを発生させず、システムを止めない対策が必要です。
例えば、「DBから取得した値が0件かどうか確認する処理」を追加するのも対策の1つです。

## Q. 【異常系】もしDBにアクセスする途中で通信Errorが発生するパターンも想定していますか？
DBにもデータがあり、検索の条件のデータも正しくてもDBにアクセスが何かしらの理由でアクセス出来ない場合があります。
その場合にも対策が必要です。
例えば、「アクセス出来なかったら、代わりにデータを表示させる。」「少し時間を空けてもう一度DBにアクセスする」などがあります。

## Q. 【異常系】`gender`の値が異なるパターンも想定していますか？
プログラムの処理内で`"その他"`と同等の処理が行われますが、想定が異なります。
`male`と`man`は、どちらも`男`で同じ意味を持ちます。
つまり、担当するプログラマーが仕様を間違うとErrorの原因になる
````diff json:Iutput.json
{
    "age" : 6,
-    "gender" : "male",
+    "gender" : "man",
}
````
対策としては、「データを定数化し、メンバー内で認識を併せて定数を使い回す」

### おわりに
今回はサンプルの仕様についてテストパターンを考えてみましたが、
サンプルの仕様に関連する機能がある場合は、条件が増えるためさらにテストパターンが増えます。
テストは、一見簡単そうな工程と思われますが、とても責任がかかる大事な工程です。
